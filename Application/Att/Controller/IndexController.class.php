<?php/** * Created by PhpStorm. * User: wangsfox * Date: 2017/10/10 * Time: 18:39 */namespace Att\Controller;use Think\Controller;class IndexController extends Controller{    //签到    public $_info, $_Att;    public function _initialize()    {        $this->_Att = M('user');    }    public function index()    {        $this->_info = cookie('info');        if (I('submit') || $this->_info) {            $data = [                'name' => I('name')?: $this->_info['name'],                'phone' => I('phone')?: $this->_info['phone'],                'company' => I('company')?: $this->_info['company'],                'dept' => I('dept')?:$this->_info['dept'],                'isload'=>1,                'loadtime' => time()            ];            $_cookie = [                'name' => $data['name'],                'phone' => $data['phone']            ];            $userinfo = $this->_Att->where($_cookie)->find();            if ($userinfo) {                $this->_info = $userinfo;                $isok = $this->_Att->where(['id' => $userinfo['id']])->save($data);                if ($isok) {                    //存cookie                    cookie('info', $userinfo);                    $this->success('签到成功',U('show'));                } else {                    $this->error('签到失败,可能是没有录入您的信息,请联系现场签到人员');                }            } else {                $this->error('签到失败,可能是您输入的信息有误,请检查输入信息是否正确');            }        } else {            $this->display();        }    }    //显示信息    public function show()    {        $this->islogin();        $this->display();    }    // 议程安排    public  function profile(){        $this->islogin();        $this->assign('info',cookie('info'));        $this->display();    }    // 检测登录    public  function  islogin(){        $islogin=cookie('info');        if (!$islogin){            redirect(U('index'));        }    }}